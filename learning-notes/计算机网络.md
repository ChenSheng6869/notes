# 计算机网络

# 1 计算机网络体系结构

|    OSI     |  五层协议  |      TCP/IP       |
| :--------: | :--------: | :---------------: |
|   应用层   |            |                   |
|   表示层   |   应用层   |      应用层       |
|   会话层   |            |                   |
|   传输层   |   传输层   | 传输层（TCP/UDP） |
|   网络层   |   网络层   |  网络层（IP层）   |
| 数据链路层 | 数据链路层 |    网络接口层     |
|   物理层   |   物理层   |                   |

* 五层协议
  * 应用层：单位，报文。为特定应用程序提供数据传输服务（HTTP、DNS）。
  * **传输层：为进程提供通用数据传输服务。**TCP提供完整性服务，UDP提供及时性服务
  * 网络层：为主机提供数据传输服务，**把传输层传递下来的报文段或者用户数据报封装成分组**
  * 数据链路层：为同一链路的主机提供数据传输服务，数**据链路层把网络层传下来的分组封装成帧**
  * 物理层：考虑的是怎么在传输媒介上传输比特流
* TCP/IP四层协议

**在向下的过程中，需要添加下层协议所需要的首部或者尾部，而在向上的过程中不断拆开首部和尾部。**

**路由器**只有下面三层协议，因为路由器位于网络核心中，**不需要为进程或者应用程序提供服务，因此也就不需要传输层和应用层。**

## 1.1 物理层

**考虑如何传输比特流。典型设备：集线器。**

## 1.2 数据链路层

**为同一链路主机提供数据传输服务。典型设备：交换机。典型协议：ppp**

* **封装成帧**

将网络层传下来的的分组添加首部和尾部，用于标记帧的开始和结束

* **透明传输**

添加转义字符，用户察觉不到转义字符的存在

* **差错检测**

循环冗余检验（CRC）来检查比特差错

## 1.3 网络层（IP层）

**为主机之间提供数据传输服务。典型设备：路由器，配套协议：ARP、ICMP**

* 地址解析协议ARP

  网络层实现主机之间的通信，而链路层实现具体每段链路之间的通信。因此在通信过程中，IP 数据报的源地址和目的地址始终不变，而 MAC 地址随着链路的改变而改变。

* 网际控制报协议ICMP

  ICMP 是为了更有效地转发 IP 数据报和提高交付成功的机会。它封装在 IP 数据报中，但是不属于高层协议。

  **Ping 是 ICMP** 的一个重要应用，主要用来测试两台主机之间的连通性。

  Ping 的原理是**通过向目的主机发送 ICMP Echo 请求报文，目的主机收到之后会发送 Echo 回答报文。**P**ing 会根据时间和成功响应的次数估算出数据包往返时间以及丢包率。**

## 1.4 传输层

**传输层提供了进程间的逻辑通信**，传输层向高层用户屏蔽了下面网络层的核心细节，使应用程序看起来像是在两个传输层实体之间有一条端到端的逻辑通信信道。

* **TCP/UDP的特点**

  * UDP，无连接，尽最大可能交付，没有拥塞控制
  * TCP，面向连接，提供可靠交付，有流量控制，拥塞控制，提供全双工通信，面向字节流，点对点（1对1）

* **TCP报文段首部格式**

  * **序号**：对字节流进行编号，第一个字节流301，数据长度100，第二个字节流序号就是401
  * **确认号**：期望收到的下一个报文段序号，比如序号的下一个401
  * **数据偏移**：首部的长度
  * **确认ACK**：ACK=1，确认号字段有效。TCP规定，在建立连接后所有传送的报文段都必须把ACK置1.
  * **同步SYN**：在建立连接时用来同步序号。SYN=1，ACK=0表示是一个连接请求的字段。如果双方都同意建立连接，则响应报文中SYN=1，ACK=1.
  * **中止FIN**：用来释放一个连接，FIN=1，表示此报文段的发送方数据已发送完毕，并要求释放连接。
  * **窗口**：窗口值作为接收方让发送方设置其发送窗口的依据，因为接收方数据缓存空间有限。

* **TCP三次握手**

* * 服务端的Listen，等待客户端连接；
  * **1.**客户端向服务端的发送连接请求，SYN=1，ACK=0，选择一个初始序号x；
  * **2.**服务端收到请求报文，若同意建立连接，向客户端发送连接确认报文，SYN=1，ACK=1，确认号x+1，同时选择一个初始序号y；
  * **3.**客户端接收到服务端连接确认报文后，ACK=1，向服务端发送序号x+1，确认号为y+1；
  * 服务端收到客户端确认，连接建立

  ​

* **TCP三次握手原因**

  * 防止无效连接请求到达服务器，错误打开连接。客户端发送的连接请求如果在网络中滞留，那么就会隔很长一段时间才能收到服务器端发回的连接确认。**客户端等待一个超时重传时间**之后，就会**重新请求连接**。但是这个滞留的连接请求最后还是会到达服务器，如果**不进行三次握手**，那么服务器**就会打开两个连接**。

* **TCP四次挥手**

  * 四次挥手时的序号和确认号与建立连接时的用法相同。
  * A发送释放连接报文，FIN=1；
  * B收到后发出确认，TCP处于半关闭状态，B可以向A发送数据，A不能向B发送数据；
  * B不再需要连接，发送连接释放报文，FIN=1
  * A收到后发出确认，进入，TIME_WAIT状态，等待2MSL后释放连接
  * B收到A确认后释放连接

* **TCP四次挥手原因**

  让服务端发送未处理完的数据，发送完成后，发送FIN连接释放报文。

  **等待2MSL原因**：确保最后一个确认报文到达，让本次连接产生的报文从网络中消失，使得下一个连接不会出现旧的请求连接报文。

* **TCP可靠传输**

  TCP使用超时传输实现可靠传输

* **TCP滑动窗口**

  窗口作为缓存的一部分，用来暂时存放字节流。

  接收方通过TCP中的报文字段告诉发送方自己窗口大小，发送方根据这个值和其他信息设置自己窗口大小。

* **TCP流量控制（通过发送确认报文中的窗口字段控制发送方窗口大小）**

  流量控制是为了控制发送方发送速率，保证接收方来得及接收。

  接收方发送的确认报文中的窗口字段可以用来控制发送方窗口大小，从而影响发送方的发送速率。将窗口字段设置为 0，则发送方不能发送数据。

* **TCP拥塞控制**

  网络出现堵塞，分组将丢失，发送方重传，导致网络拥塞程度更高。因此当拥塞时，应控制发送方的发送速率。

  发送方需要**维护一个叫做拥塞窗口（cwnd）的状态变量**，注意拥塞窗口与发送方窗口的区别：拥塞窗口只是一个状态变量，实际决定发送方能发送多少数据的是发送方窗口。

  TCP提供四个算法进行拥塞控制。

  * 慢开始、拥塞避免

  ​

  * 快重传、快恢复

  ​

## 1.5 应用层

FTP DHCP SMTP



# 2 HTTP

